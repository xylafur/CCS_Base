<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="../../components/webcomponentsjs/webcomponents-lite.min.js"></script>
    <script type='text/javascript' src="../../components/ti-core-assets/scripts/q.js"></script>
    
    <link rel="import" href="../../components/iron-icons/av-icons.html">
    <link rel="import" href="../../components/iron-icons/iron-icons.html">
    <link rel="import" href="../../components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="../../components/paper-item/paper-icon-item.html">
    <link rel="import" href="../../components/paper-tooltip/paper-tooltip.html">
    <link rel="import" href="../../components/paper-tree/paper-tree.html">
    <link rel="import" href="../../components/polymer/polymer.html">
    <link rel="import" href="../../components/ti-widget-common/ti-widget-checkbox.html">
    <link rel="import" href="../../components/ti-widget-common/ti-widget-container.html">
    <link rel="import" href="../../components/ti-widget-common/ti-widget-input.html">
    <link rel="import" href="../../components/ti-widget-common/ti-widget-label.html">
    <link rel="import" href="../../components/ti-widget-toast/ti-widget-toast.html">
    <link rel="import" href="../../components-dbgtrc/ti-trace-config/ti-dbgtrc-config-dialog.html">
    <link rel="import" href="../../components-dbgtrc/ti-trace-cptracer2/ti-trace-cptracer2-common-config.html">
    <link rel="import" href="../../components-dbgtrc/ti-trace-cptracer2/ti-trace-cptracer2-usecase-config.html">
    <link rel="import" href="../../components-dbgtrc/ti-trace-config/ti-trace-receiver.html">

</head>

<body>
    <dom-module id="ti-trace-cptracer2-settings">
        <template>
            <style>
                .settings {
                    margin: 5px;
                    padding-top: 5px;
                    padding-bottom: 5px;
                    padding-left: 10px;
                    padding-right: 10px;
                    font-size: 14px;
                    font-style: italic;
                    font-weight: bold;
                    color: #115566,
                }
                #probeInputToast {
                    position: absolute;
                    z-index: 10;
                }
                #filterInputToast {
                    position: absolute;
                    z-index: 10;
                }
                .filtrow {
                    content: "";
                    display: table;
                    clear: both;
                }
                .filtcol1 {
                    float: left;
                    width: 300px;
                    padding: 10px;
                }
                .filtcol2 {
                    float: right;
                    width: 50%;
                    padding: 10px;
                }

                paper-icon-item {
                    text-align: left
                    --paper-item-icon-width=24px;
                }
            </style>
            <ti-dbgtrc-config-dialog id="traceSettings" header-text="Traffic Profiling Settings" on-opened-changed="_openedChanged">
                <div class="settings">
                    Step 1. Configure the probes and usecases.
                </div>
                <div>
                    <ti-trace-cptracer2-common-config zero-suppress="{{zeroSuppress}}" domain-labels=[[domainLabels]] selected-domain-changed=[[selectedDomainChanged]] probe-labels=[[probeLabels]]></ti-trace-cptracer2-common-config>
                </div>
                <br />
                <div>
                    <ti-trace-cptracer2-usecase-config id="throughputUC" 
                        use-case-label=[[throughputUCLabel]]
                        use-case-description=[[throughputUCDesc]]
                        probe-labels=[[probeLabels]] 
                        probe-enable-check-changed=[[probeEnableCheckChanged]]
                        probe-config=[[probeConfig]]
                        columns-exposed=[[throughputColumns]]>
                    </ti-trace-cptracer2-usecase-config>

                    <ti-trace-cptracer2-usecase-config id="latencyUC"
                        use-case-label=[[latencyUCLabel]]
                        use-case-description=[[latencyUCDesc]]
                        probe-labels=[[probeLabels]]
                        probe-enable-check-changed=[[probeEnableCheckChanged]]
                        probe-config=[[probeConfig]]
                        columns-exposed=[[latencyColumns]]>
                    </ti-trace-cptracer2-usecase-config>

                    <ti-trace-cptracer2-usecase-config id="transactionUC"
                        use-case-label=[[transactionUCLabel]]
                        use-case-description=[[transactionUCDesc]]
                        probe-labels=[[probeLabels]]
                        probe-enable-check-changed=[[probeEnableCheckChanged]]
                        probe-config=[[probeConfig]]
                        columns-exposed=[[transactionColumns]]>
                    </ti-trace-cptracer2-usecase-config>
                </div>
                <br />
                <div class="settings">
                    Step 2. Optional advanced settings to change the trace export interface configuration from default settings:
                </div>
                <div>
                    <ti-trace-receiver config={{traceProperties}}></ti-trace-receiver>
                </div>
            </ti-dbgtrc-config-dialog>

            <ti-dbgtrc-config-dialog id="probeConfigDialog" header-text="[[probeConfigDialogHeading]]" on-opened-changed="_openedChanged">
                <ti-widget-container>
                    <div id="filterDiv">
                        <table>
                            
                            <tr>
                                <th colspan="3">
                                    Use Case: [[currentUseCase]]
                                </th>
                            </tr>
                            <tr>
                                <td class="probecol1">
                                    <br>
                                    <ti-widget-label id="sampleWindowLabel" label="Sampling Window:"></ti-widget-label>
                                </td>
                                <td class="probecol2">
                                    <ti-widget-input id="sampleWindowInput" floating-label=true label="(0x1000 - 0xffffff)" on-changed="_probeInputFieldChanged" value="{{sampleWindow}}" disabled="{{_isEqualTo(currentUseCase, 'Transaction Trace')}}"></ti-widget-input>
                                    <paper-tooltip for="sampleWindowInput" position="bottom">Measurement interval in clock cycles for detecting statistics event.</paper-tooltip>
                                </td>
                            </tr>

                            <tr>
                                <td class="probecol1">
                                    <ti-widget-label label="Address Range Low:"></ti-widget-label>
                                </td>
                                <td class="probecol2">
                                    <ti-widget-input id="addrRangeLow" floating-label=true label="(0x0 - 0xffffffffffff)" on-changed="_probeInputFieldChanged" value="{{rangeLow}}"></ti-widget-input>
                                    <paper-tooltip for="addrRangeLow" position="left">Start of address range window</paper-tooltip>
                                </td>
                            </tr>

                            <tr>
                                <td class="probecol1">
                                    <ti-widget-label label="Address Range High:"></ti-widget-label>
                                </td>
                                <td class="probecol2">
                                    <ti-widget-input id="addrRangeHigh" floating-label=true label="(0x0 - 0xffffffffffff)" on-changed="_probeInputFieldChanged" value="{{rangeHigh}}"></ti-widget-input>
                                    <paper-tooltip for="addrRangeHigh" position="left">End of address range window</paper-tooltip>
                                </td>
                            </tr>

                            <tr>
                                <td class="probecol1">
                                    <ti-widget-checkbox id="rangeExclude" label="Exclude address range" checked={{excludeChecked}}></ti-widget-checkbox>
                                    <paper-tooltip for="rangeExclude" position="right">Check to exclude transactions within specified Low/High range.</paper-tooltip>
                                </td>
                            </tr>

                            <tr>
                                <td colspan="2">
                                    <ti-widget-toast id="probeInputToast"></ti-widget-toast>
                                </td>
                            </tr>

                            <tr>
                                <td colspan="2">
                                    <ti-widget-label id="nonDefaultFiltersLabel" label="Non-Default Filters Applied:" text-decoration="underline" font-weight="bold"></ti-widget-label>
                                    <paper-tooltip for="nonDefaultFiltersLabel" position="right">Default value for all filters and masks is 0x0</paper-tooltip>
                                </td>
                            </tr>

                            <tr>
                                <td class="probecol1">
                                    <paper-icon-button id="addfilterButton" icon="add-box" style="color:green;" on-tap="_addFilterDialog"></paper-icon-button>
                                    <paper-tooltip for="addfilterButton" position="right">Add filter</paper-tooltip>
                                </td>
                            </tr>

                            <template id="filterList" is="dom-repeat" items="[[filtersApplied]]" as="filter">
                                <tr>
                                    <td class="probecol1">
                                        <paper-button id="remove-[[index]]" on-tap="_deleteFilter">
                                            <iron-icon icon="clear" style="color:red"></iron-icon>
                                            [[filter.name]]: Value=[[filter.value]]; Mask=[[filter.mask]]
                                        </paper-button>
                                        <paper-tooltip for="remove-[[index]]" position="right">Remove filter</paper-tooltip>
                                    <td>
                                </tr>
                            </template>
                        </table>
                    </div>
                </ti-widget-container>
            </ti-dbgtrc-config-dialog>

            <ti-dbgtrc-config-dialog id="filterSelectDialog" header-text="[[probeConfigDialogHeading]]" on-opened-changed="_openedChanged">
                <ti-widget-container>
                    <div class="filtrow">
                        <div class="filtcol1">
                            <paper-tree id='filterSelectTree' selected="{{filterTreeSelected}}" data='{
                                "name": "Filters",
                                "icon": "icons:arrow-drop-down",
                                "open": true,
                                "isfilter":"false",
                                "children": [
                                    {
                                        "name": "Addressing and ordering",
                                        "icon": "icons:arrow-drop-down",
                                        "isfilter":"false",
                                        "children": [
                                            {"name": "Channel ID", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0xFFF", "isfilter":"true"},
                                            {"name": "Order ID", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0xF", "isfilter":"true"},
                                            {"name": "Address Mode", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3", "isfilter":"true"},
                                            {"name": "Route ID", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0xFFF", "isfilter":"true"},
                                            {"name": "Region Select", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0xF", "isfilter":"true"},
                                            {"name": "Virtual ID", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0xFFF", "isfilter":"true"}
                                        ]
                                    },
                                    {
                                        "name": "Type and size",
                                        "icon": "icons:arrow-drop-down",
                                        "isfilter":"false",
                                        "children": [
                                            {"name": "Exclusive", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x1", "isfilter":"true"},
                                            {"name": "Direction", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x1", "isfilter":"true"},
                                            {"name": "Data Type", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3", "isfilter":"true"},
                                            {"name": "Line Size", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x7", "isfilter":"true"},
                                            {"name": "Byte Count", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3FF", "isfilter":"true"},
                                            {"name": "OP Code", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3F", "isfilter":"true"},
                                            {"name": "Memory Type", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3", "isfilter":"true"},
                                            {"name": "Address Type", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3", "isfilter":"true"}
                                        ]
                                    },
                                    {
                                        "name": "Priority and QoS",
                                        "icon": "icons:arrow-drop-down",
                                        "isfilter":"false",
                                        "children": [
                                            {"name": "Escalated Priority", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x7", "isfilter":"true"},
                                            {"name": "Priority", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x7", "isfilter":"true"},
                                            {"name": "QoS", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x7", "isfilter":"true"}
                                        ]
                                    },
                                    {
                                        "name": "Debug",
                                        "icon": "icons:arrow-drop-down",
                                        "isfilter":"false",
                                        "children": [
                                            {"name": "Privilege", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3", "isfilter":"true"},
                                            {"name": "Secure", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x1", "isfilter":"true"},
                                            {"name": "Privilege ID", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0xFF", "isfilter":"true"}
                                        ]
                                    },
                                    {
                                        "name": "Cache and domain control",
                                        "icon": "icons:arrow-drop-down",
                                        "isfilter":"false",
                                        "children": [
                                            {"name": "Pre-fetchable", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x1", "isfilter":"true"},
                                            {"name": "Shareability", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3", "isfilter":"true"},
                                            {"name": "Outer Cache", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3", "isfilter":"true"},
                                            {"name": "Inner Cache", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3", "isfilter":"true"}
                                        ]
                                    },
                                    {
                                        "name": "Other",
                                        "icon": "icons:arrow-drop-down",
                                        "isfilter":"false",
                                        "children": [
                                            {"name": "Mirrored Sideband", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3F", "isfilter":"true"},
                                            {"name": "Sideband", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0xFF", "isfilter":"true"},
                                            {"name": "Flush", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x1", "isfilter":"true"},
                                            {"name": "Firewall Status", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0x3", "isfilter":"true"},
                                            {"name": "Slave Select", "icon":"icons:remove", "rangelow":"0x0", "rangehigh":"0xF", "isfilter":"true"}
                                        ]
                                    }
                                ]}'
                                actions=''>
                            </paper-tree>
                        </div>
                        <div class="filtcol1">
                            <ti-widget-label label="Filter Description:" text-decoration="underline" font-weight="bold"></ti-widget-label>
                            <template is="dom-repeat" items="[[filterTreeDescription]]" as="desc">
                                <div class="layout horizontal">
                                        [[desc]]
                                    </paper-icon-item>
                                </div>
                            </template>
                            <ti-widget-input id="filterInput" floating-label=true label="[[filterInputLabel]]" on-changed="_inputValueChanged" value="{{filterInputValue}}"></ti-widget-input>
                            <ti-widget-input id="filterMaskInput" floating-label=true label="[[filterInputMaskLabel]]" on-changed="_inputValueChanged" value="{{filterMaskInputValue}}"></ti-widget-input>
                            <ti-widget-toast id="filterInputToast"></ti-widget-toast>
                        </div>
                    </div>
                </ti-widget-container>
            </ti-dbgtrc-config-dialog>
            
        </template>
        <script>
            Polymer ({
                is: "ti-trace-cptracer2-settings",

                properties: {
                    aetProperties: {
                        type: Array,
                        value: undefined,
                        notify: true,
                        reflectToAttribute: true
                    },
                    workingAetProperties : {
                        type: Array,
                        value: [],
                        notify: true
                    },
                    domainLabels: {
                        type: String,
                        notify: true
                    },
                    selectedDomainChanged: {
                        type: Object,
                        notify: true
                    },
                    probeLabels: {
                        type: Array,
                        value: [],
                        notify: true
                    },
                    probeEnableCheckChanged: {
                        type: Object,
                        notify: true
                    },
                    probeConfig: {
                        type: Object,
                        notify: true
                    },
                    probeConfigDialogHeading: {
                        type: String,
                        notify: true,
                        value: "Probe Settings"
                    },
                    throughputColumns: {
                        type: Array,
                        value: function () {
                            return this._throughputColumns();
                        }
                    },
                    throughputUCLabel: {
                        type: String,
                        value: "Throughput Statistics"
                    },
                    throughputUCDesc: {
                        type: String,
                        value: "Measure the amount of data that is transferred across an interface." 
                    },
                    latencyColumns: {
                        type: Array,
                        value: function () {
                            return this._latencyColumns();
                        }
                    },
                    latencyUCLabel: {
                        type: String,
                        value: "Latency Statistics"
                    },
                    latencyUCDesc: {
                        type: String,
                        value: "Measure how long transaction requests across an interface take to complete."
                    },
                    transactionColumns: {
                        type: Array,
                        value: function () {
                            return this._transactionColumns();
                        }
                    },
                    transactionUCLabel: {
                        type: String,
                        value: "Transaction Logging"
                    },
                    transactionUCDesc: {
                        type: String,
                        value: "Log transactions occuring across an interface."
                    },
                    traceProperties: {
                        type: Array
                    },
                    zeroSuppress: {
                        type: Boolean,
                        value: false,
                        notify: true,
                        observer: '_zeroSuppressChanged'
                    },
                    filtersApplied : {
                        type: Array,
                        value: [],
                        notify: true
                    },
                    currentFilter : {
                        type: Object,
                        notify: true,
                        value: {
                            name: "",
                            icon: "icons:remove",
                            desc: "",
                            rangehigh: 0x0,
                            rangelow: 0x0,
                            isfilter: false
                        }
                    },
                    filterInputValue : {
                        type: Number,
                        notfiy: true
                    },
                    filterMaskInputValue : {
                        type: Number,
                        notfiy: true
                    },
                    filterInputLabel : {
                        type: String,
                        value: "Select a child element"
                    },
                    filterInputMaskLabel : {
                        type: String,
                        value: "Select a child element"
                    },
                    filterTreeSelected : {
                        type: Object,
                        notify: true,
                        observer: '_filterTreeSelectedChanged'
                    },
                    filterConfigDialogHeading: {
                        type: String,
                        notify: true,
                        value: "Filter Settings"
                    },
                    filterTreeDescription: {
                        type: Array,
                        notify: true,
                        value: []
                    },
                    currentProbe: {
                        type: String,
                        notify: true,
                        observer: '_currentProbeChanged'
                    },
                    currentUseCase: {
                        type: String,
                        notify: true
                    },
                    excludeChecked: {
                        type: Boolean,
                        notify: true,
                        reflectToAttribute: true,
                        value: false
                    },
                    rangeLow: {
                        type: String,
                        notify: true,
                        reflectToAttribute: true,
                        value: "0x0"
                    },
                    rangeHigh: {
                        type: String,
                        notify: true,
                        reflectToAttribute: true,
                        value: "0xffffffffffff"
                    },
                    sampleWindow: {
                        type: String,
                        notify: true,
                        reflectToAttribute: true,
                        value: "0x3ffff"
                    }
                },

                open: function() {
                    this.$.traceSettings.toggle();
                },

                _openedChanged: function (evt) {

                    var _self = this;
                    
                    if ("probeConfigDialog" == evt.srcElement.id) {
                        if ("confirmed" == this.$.probeConfigDialog.closingReason) {
                            _self.aetProperties = _self.workingAetProperties;
                        }
                    }
                },

                _throughputColumns: function() {
                    return [
                        {     
                            name: "Total Bytes",
                            desc:
                                [ "The total number of byte transactions observed at probe interface.",
                                    "Valid range: 0 - 0xFFFFFFFF",
                                ]
                        },
                        {     
                            name: "Total Matched",
                            desc:
                                [ "The total number of byte transactions observed at probe interface that have matched the filtering criteria.",
                                    "Valid range: 0 - 0xFFFFFF"
                                ]
                        },
                        {     
                            name: "Average Length",
                            desc:
                                [ "The average transaction length calculated by Total Bytes / Total Matched.",
                                    "Valid range: 0 - 0xFFFFFFFF"
                                ]
                        }
                    ];
                },

                _latencyColumns: function() {
                    return [
                        {     
                            name: "Tracked",
                            desc:
                                [ "The total number of transactions observed at probe interface.",
                                    "Valid range: 0 - 0xFFFFFF"
                                ]
                        },
                        {     
                            name: "Matched",
                            desc:
                                [ "The total number of transactions observed at probe interface that have matched the filtering criteria.",
                                    "Valid range: 0 - 0xFFFFFF"
                                ]
                        },
                        {     
                            name: "Max Wait",
                            desc:
                                [ "The maximum wait time observed at probe interface.",
                                    "Valid range: 0 - 0xFFFF"
                                ]
                        },
                        {     
                            name: "Total Wait",
                            desc:
                                [ "The total wait time observed at probe interface.",
                                    "Valid range: 0 - 0xFFFFFFFF"
                                ]
                        },
                        {     
                            name: "Credit Wait",
                            desc:
                                [ "The credit wait time observed at probe interface for credit-based buses.",
                                    "Valid range: 0 - 0xFFFFFF"
                                ]
                        }
                    ];
                },

                _transactionColumns: function() {
                    return [
                        {     
                            name: "Address",
                            desc:
                                [ "The address of the observed transaction.",
                                    "Valid range: 0 - 0xFFFFFFFFFFFF"
                                ]
                        },
                        {     
                            name: "Address Mode",
                            desc:
                                [ "The value of the transaction address mode.",
                                    "0 = linear incrementing",
                                    "1..3 = reserved"
                                ]
                        },
                        {     
                            name: "Route ID",
                            desc: 
                                [ "The route ID of the transaction.",
                                    "Valid range: 0 - 0xFFF",
                                    "The route ID is a unique ID assigned to each master interface of the system."
                                ]
                        },
                        {     
                            name: "Direction",
                            desc:
                                [ "The direction of the transaction.",
                                    "0 = write",
                                    "1 = read"
                                ]
                        },
                        {     
                            name: "Exclusive",
                            desc:
                                [ "The exclusivity of the transaction.",
                                    "0 = normal",
                                    "1 = exclusive"
                                ]
                        },
                        {     
                            name: "Byte Count",
                            desc:
                                [ "Burst size of the transaction.",
                                    "Valid range: 0 - 0x3FF"
                                ]
                        },
                        {     
                            name: "Priority",
                            desc: 
                                [ "The priority of the transaction",
                                    "0 = highest",
                                    "7 = lowest"
                                ]
                        },
                        {     
                            name: "Line Size",
                            desc:
                                [ "Cache line size for constant or cache line wrap addressing modes.",
                                    "0 = 16 bytes",
                                    "1 = 32 bytes",
                                    "2 = 64 bytes",
                                    "4 = 128 bytes",
                                    "5-7 = reserved"
                                ]
                        },
                        {     
                            name: "Privilege",
                            desc: 
                                [ "The privilege level of the transaction.",
                                    "0 = user",
                                    "1 = supervisor",
                                    "2 = hypervisor",
                                    "3 = hypervisor supervisor"
                                ]
                        },
                        {     
                            name: "Privilege ID",
                            desc: 
                                [ "The privilege ID of the transaction.",
                                    "Valid range: 0 - 0x0FF",
                                    "The ID of the logical entity that is responsible for the current transaction."
                                ]
                        },
                        {     
                            name: "Data Type",
                            desc: 
                                [ "The data type of the transaction.",
                                    "0 - CPU Data Access",
                                    "1 - CPU Instruction Access",
                                    "2 - DMA Access",
                                    "3 - Reserved"
                                ]
                        },
                        {     
                            name: "Region Select",
                            desc:
                                [ "The region of the transaction.",
                                    "Valid range: 0 - 0xF"
                                ]
                        },
                        {     
                            name: "Interest",
                            desc:
                                [ "Debug marker (typically software controlled) intended to mark a transaction for trace or statistics collection.",
                                    "0 = normal",
                                    "1 = interest set"
                                ]
                        },
                        {     
                            name: "Debug Initiated",
                            desc: 
                                [ "Indicates that the transaction was initiated by debug.",
                                    "0 = normal",
                                    "1 = debug initiated"
                                ]
                        },
                        {     
                            name: "Inner Cache",
                            desc:
                                [ "Transaction for inner cache domain.",
                                    "0 = Non-allocateable. Caches in the domain must not allocate.",
                                    "1 = Writes should allocate. Reads must not allocate.",
                                    "2 = Reads should allocate. Writes must not allocate.",
                                    "3 = Reads and writes should allocate."
                                ]
                        },
                        {     
                            name: "Outer Cache",
                            desc:
                                [ "Transaction for outer cache domain.",
                                    "0 = Non-allocateable. Caches in the domain must not allocate.",
                                    "1 = Writes should allocate. Reads must not allocate.",
                                    "2 = Reads should allocate. Writes must not allocate.",
                                    "3 = Reads and writes should allocate."
                                ]
                        },
                        {     
                            name: "Shareability",
                            desc:
                                [ "Indicates the shareability domain of the transaction.",
                                    "0 = Non-shareable",
                                    "1 = Inner shareable",
                                    "2 = Outer shareable",
                                    "3 = System shareable"
                                ]
                        },
                        {     
                            name: "QoS",
                            desc:
                                [ "Indicates the quality of service of the transaction",
                                    "Valid range: 0-7"
                                ]
                        },
                        {     
                            name: "Secure",
                            desc: 
                                [ "Indicates whether the transaction is secure.",
                                    "0 = not secure",
                                    "1 = secure"
                                ]
                        },
                        {     
                            name: "Memory Type",
                            desc:
                                [ "The memory type of the transaction.",
                                    "0 = Device memory",
                                    "1 = Normal writeback cacheable memory",
                                    "2 = Normal write-through cacheable memory",
                                    "3 = Normal non-cacheable memory"
                                ]
                        },
                        {     
                            name: "OP Code",
                            desc:
                                [ "The opcode of the transaction.",
                                    "Valid range: 0 - 0x3F"
                                ]
                        },
                        {     
                            name: "Sideband",
                            desc:
                                [ "The CSIDEBAND bus.",
                                    "Valid range: 0 - 0xFF"
                                ]
                        },
                        {
                            name: "Flush",
                            desc:
                                [ "Signal that indicates transaction has been invalidated.",
                                    "0 = normal",
                                    "1 = blocked"
                                ]
                        },
                        {     
                            name: "Escalated Priority",
                            desc:
                                [ "The escalated priority of the transaction.",
                                    "0 = highest",
                                    "7 = lowest"
                                ]
                        },
                        {     
                            name: "Order ID",
                            desc:
                                [ "The Order ID signal indicates how transactions need to be ordered at the endpoint slave.",
                                    "Valid range: 0 - 0xF",
                                    "By default, all transactions within the same order ID will be treated as stronly ordered by the endpoint slaves."
                                ]
                        },
                        {     
                            name: "Mirrored Sideband",
                            desc:
                                [ "The CMSIDEBAND bus.",
                                    "Valid range: 0 - 0xFF"
                                ]
                        },
                        {     
                            name: "Firewall Status",
                            desc:
                                [ "Signal that indicates the previously passing firewall status of a transaction.",
                                    "0 = Security and isolation firewalls not checked.",
                                    "1 = Security firewall checked and isolation firewall not checked.",
                                    "2 = Security firewall not checked and isolation firewall checked.",
                                    "3 = Security and isolation firewalls checked."
                                ]
                        },
                        {     
                            name: "Pre-fetchable",
                            desc:
                                [ "Indicates pre-fetchbility of the transactions.",
                                    "0 = device memory",
                                    "1 = normal writeback cacheable memory"
                                ]
                        },
                        {     
                            name: "Virtual ID",
                            desc:
                                [ "The virtualization ID of the transaction",
                                    "Valid range: 0 - 0xFFF"
                                ]
                        },
                        {     
                            name: "Slave Select",
                            desc:
                                [ "Indicates the predetermined slave select of the transaction.",
                                    "0 = No default slave select (decode based on address).",
                                    "1 = Forward the transaction to the slave based on the SoC map."
                                ]
                        },
                        {     
                            name: "Address Type",
                            desc:
                                [ "Indicates the address type of the transaction",
                                  "0 = Physical address.",
                                  "1 = Intermediate address.",
                                  "2 = Virtual address.",
                                  "3 = Translated address (physical address with all memory attributes)."
                                ]
                        },
                        {     
                            name: "Channel ID",
                            desc:
                                [ "Indicates the channel ID of a transaction.",
                                    "Valid range: 0 - 0xFFF",
                                    "This value is used by downstream hardware for identifying ownership/permissions/address translations."
                                ]
                        }
                    ];
                },

                _probeInputFieldChanged: function(event) {
                    var _self = this;
                    var inputValue = 0;
                    var prependHex = false;
                    var defaultValue = 0;
                    var rangeLow = 0;
                    var rangeHigh = 0;
                    var fieldName = "";

                    if ("sampleWindowInput" == event.srcElement.id) {
                        defaultValue = 0x3FFF;
                        rangeLow = 0x1000;
                        rangeHigh = 0xFFFFFF;
                        fieldName = "Sample Window";
                    }
                    else if ("addrRangeLow" == event.srcElement.id) {
                        defaultValue = 0x0;
                        rangeLow = 0x0;
                        rangeHigh = 0xFFFFFFFFFFFF;
                        fieldName = "Address Range Low";
                    }
                    else if ("addrRangeHigh" == event.srcElement.id) {
                        defaultValue = 0xFFFFFFFFFFFF;
                        rangeLow = 0x0;
                        rangeHigh = 0xFFFFFFFFFFFF;
                        fieldName = "Address Range High";
                    }
                    else {
                        return;
                    }

                    try {
                        if( !/^(0x)?[0-9a-f]+$/i.test(event.detail.newValue) ) {
                            throw "Not a number";
                        }

                        inputValue = parseInt(event.detail.newValue);

                        if ((inputValue < rangeLow) || (inputValue > rangeHigh)) {
                            _self.$.probeInputToast.message = "Invalid " + fieldName + ": " + event.detail.newValue;
                            _self.$.probeInputToast.showToast();
                            event.srcElement.value = defaultValue;
                            prependHex = true;
                        }
                    }
                    catch(e) {
                        _self.$.probeInputToast.message = "Invalid " + fieldName + ": " + event.detail.newValue;
                        _self.$.probeInputToast.showToast();
                        event.srcElement.value = defaultValue;
                        prependHex = true;
                    }

                    // Always re-display the number back as a hex string.
                    if (prependHex) {
                        event.srcElement.value = "0x" + event.srcElement.value.toString(16);
                    }
                    else {
                        event.srcElement.value = event.srcElement.value.toString(16);
                    }

                    // Update temporary tree with new values.
                    //_setProbeConfigValue(tree, probe, useCase, sampleWindow, low, high, exclude)
                    var usecase = _self._getProbeUseCase(_self.currentProbe);
                    if(!_self._setProbeConfigValue(_self.workingAetProperties, _self.currentProbe, usecase, _self.sampleWindow, _self.rangeLow, _self.rangeHigh, _self.excludeChecked)) {
                        console.log("Failed to set probe property tree for "+_self.currentProbe+".");        
                    }

                },

                _isEqualTo: function (value1, value2) {
                    return value1 == value2;
                },

                _getLocalProperty(object, name) {
                    var returnObj = {};
                    var _self = this;

                    if (object instanceof Array) {
                        for (var i=0; i<object.length; i++) {
                            if (object[i].name == name) {
                                returnObj = object[i];
                                return returnObj;
                            }

                            if (object[i].sub_properties instanceof Array) {
                                returnObj = _self._getLocalProperty(object[i].sub_properties, name);
                                if (returnObj.name == name) {
                                    return returnObj;
                                }
                            }
                        }                    
                    }
                    else {
                        if (object.name == name) {
                            returnObj = object;
                            return returbObj;
                        }

                        if (object.sub_properties instanceof Array) {
                            returnObj = _self._getLocalProperty(object.sub_properties, name);
                            if (returnObj.name == name) {
                                return returnObj;
                            }
                        }
                    }

                    return returnObj;
                },

                _formatPropertyValueToHexString: function(prop) {
                    var str = "";
                    if (prop.type == "Boolean") {
                        if (prop.value) {
                            str = "0x1";
                        }
                        else {
                            str = "0x0";
                        }
                    }
                    else if (prop.type == "Number") {
                        var num = parseInt(prop.value);
                        str = "0x" + num.toString(16);
                    }

                    return str;
                },

                _filterTreeSelectedChanged: function(newValue) {
                    var _self = this;
                    var probe;
                    var filter;
                    var filterMask;
                    var filterDetails;

                    _self.filterInputValue = 0;
                    _self.filterMaskInputValue = 0;
                    _self.filterInputLabel = "";
                    _self.filterInputMaskLabel = "";
                    _self.filterTreeDescription = [ "Select child element" ];
                    _self.$.filterInput.disabled = true;
                    _self.$.filterMaskInput.disabled = true;
                    
                    if (newValue) {
                        if (newValue.data) {

                            // Set labels and values
                            _self.currentFilter = newValue.data;
                            if (_self.currentFilter.isfilter == "true") {
                                _self.filterInputLabel = _self.currentFilter.name+" Value ("+_self.currentFilter.rangelow+"-"+_self.currentFilter.rangehigh+")";
                                _self.filterInputMaskLabel = _self.currentFilter.name+" Mask ("+_self.currentFilter.rangelow+"-"+_self.currentFilter.rangehigh+")";

                                _self.filterTreeDescription = _self.transactionColumns.find(filter => filter.name === _self.currentFilter.name).desc;

                                filterDetails = _self._getInternalFilterDetails(_self.currentFilter.name);
                                if (filterDetails.valid) {
                                    probe = _self._getLocalProperty(_self.aetProperties, _self.currentProbe);
                                    filter = _self._getLocalProperty(probe, filterDetails.name);
                                    filterMask = _self._getLocalProperty(probe, filterDetails.name+" Mask");
                                }

                                _self.filterInputValue = _self._formatPropertyValueToHexString(filter);
                                _self.filterMaskInputValue = _self._formatPropertyValueToHexString(filterMask);
                                _self.$.filterInput.disabled = false;
                                _self.$.filterMaskInput.disabled = false;
                            }
                        }
                    }
                },

                _updateFilterList: function() {

                    var _self = this;
                    var filterDesc;
                    var filterFound = false;
                    var filtersApplied = [];
                    var filtersAppliedJoined = [];

                    if (_self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties instanceof Array) {
                        for(var i=0; i<_self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties.length; i++) {
                            if (_self.currentProbe == _self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].name) {
                                if (_self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties instanceof Array) {
                                    for (var j=0; j<_self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties.length; j++) {
                                        if (_self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].sub_properties instanceof Array) {
                                            for (var k=0; k < _self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].sub_properties.length; k++ ) {
                                                //console.log(_self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].sub_properties[k]);
                                                var type = _self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].sub_properties[k].type;
                                                var name = _self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].sub_properties[k].name;
                                                var value = _self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].sub_properties[k].value;

                                                if (type == "Boolean") {
                                                    if (value) {
                                                        filtersApplied.push({name: name, value: value});
                                                    }
                                                }
                                                else if (type == "Number") {
                                                    if (value) {
                                                        filtersApplied.push({name: name, value: value});
                                                    }
                                                }
                                            }
                                        }
                                        else {
                                            //console.log(_self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j]);
                                            var type = _self.workingAetProperties[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].type;
                                            if (type == "Boolean") {
                                                    if (value) {
                                                        filtersApplied.push({name: name, value: value});
                                                    }
                                                }
                                                else if (type == "Number") {
                                                    if (value) {
                                                        filtersApplied.push({name: name, value: value});
                                                    }
                                                }
                                        }
                                    }
                                }
                                break;
                            }
                        }
                    }

                    for (var i=0; i<filtersApplied.length; i++) {

                        var isMask = filtersApplied[i].name.includes("Mask");
                        var filtShortName = filtersApplied[i].name.replace(" Mask", "");
                        var filterShortUIName = _self._getUIFilterName(filtShortName);
                        var filtValue = filtersApplied[i].value;
                        var found = false;
                        var index = 0;

                        for (var j=0; j<filtersAppliedJoined.length; j++) {
                            if (filtersAppliedJoined[j].name == filterShortUIName) {
                                found = true;
                                index = j;
                                break;
                            }         
                        }

                        if (found) {
                            if (isMask) {
                                filtersAppliedJoined[index].mask = filtValue;
                            }
                            else {
                                filtersAppliedJoined[index].value = filtValue;            
                            }
                        }
                        else {
                            if (isMask) {
                                filtersAppliedJoined.push({name: filterShortUIName, value: undefined, mask: filtValue});
                            }
                            else {
                                filtersAppliedJoined.push({name: filterShortUIName, value: filtValue, mask: undefined});          
                            }
                            
                        }
                    }

                    _self.filtersApplied = filtersAppliedJoined;

                },

                _deleteFilter: function(event) {
                    var _self = this;

                    if(!_self._setFilterValue(_self.workingAetProperties, _self.currentProbe, _self.filterTreeSelected.data.name, "0x0", "0x0", true)) {
                        console.log("Failed to set filter property tree for "+_self.currentProbe+".");        
                    }
                },

                _applyFilters: function() {
                    var _self = this;

                    // Update the current property tree that will actually be used in trace operation.
                    _self.aetProperties = _self.workingAetProperties;
                },

                _addFilterDialog: function() {
                    var _self = this;

                    _self.$.filterSelectDialog.open();
                },
                
                _getInternalFilterDetails: function(uiName) {
                    
                    //TODO - update XML to use UI names or create name map.
                    var details = {
                        valid: false,
                        name: "",
                        group: 0,
                    }

                    switch(uiName) {

                        case "Channel ID":
                            details.valid = true;
                            details.name = uiName;
                            details.group = 0;
                            break;
                        case "Order ID":
                            details.valid = true;
                            details.name = uiName;
                            details.group = 0;
                            break;
                        case "Address Mode":
                            details.valid = true;
                            details.name = "AMODE";
                            details.group = 0;
                            break;
                        case "Route ID":
                            details.valid = true;
                            details.name = uiName;
                            details.group = 0;
                            break;                        
                        case "Region Select":
                            details.valid = true;
                            details.name = "RSEL";
                            details.group = 0;
                            break;
                        case "Virtual ID":
                            details.valid = true;
                            details.name = "VIRTID";
                            details.group = 0;
                            break;
                        case "Exclusive":
                            details.valid = true;
                            details.name = "EXCL";
                            details.group = 1;
                            break;
                        case "Direction":
                            details.valid = true;
                            details.name = "DIR";
                            details.group = 1;
                            break;
                        case "Data Type":
                            details.valid = true;
                            details.name = "DTYPE";
                            details.group = 1;
                            break;
                        case "Line Size":
                            details.valid = true;
                            details.name = "CLSIZE";
                            details.group = 1;
                            break;
                        case "Byte Count":
                            details.valid = true;
                            details.name = "BYTECOUNT";
                            details.group = 1;
                            break;
                        case "OP Code":
                            details.valid = true;
                            details.name = "OPCODE";
                            details.group = 1;
                            break;
                        case "Memory Type":
                            details.valid = true;
                            details.name = "MEMTYPE";
                            details.group = 1;
                            break;
                        case "Address Type":
                            details.valid = true;
                            details.name = "ATYPE";
                            details.group = 1;
                            break;
                        case "Escalated Priority":
                            details.valid = true;
                            details.name = "EPRIORITY";
                            details.group = 2;
                            break;
                        case "Priority":
                            details.valid = true;
                            details.name = "PRIORITY";
                            details.group = 2;
                            break;
                        case "QoS":
                            details.valid = true;
                            details.name = "QOS";
                            details.group = 2;
                            break;
                        case "Debug Initiated":
                            details.valid = true;
                            details.name = "EMUDBG";
                            details.group = 3;
                        case "Interest":
                            details.valid = true;
                            details.name = "INTEREST";
                            details.group = 3;
                        case "Privilege":
                            details.valid = true;
                            details.name = "PRIV";
                            details.group = 4;
                            break;
                        case "Secure":
                            details.valid = true;
                            details.name = "SECURE";
                            details.group = 4;
                            break;
                        case "Privilege ID":
                            details.valid = true;
                            details.name = "PRIVID";
                            details.group = 4;
                            break;
                        case "Pre-fetchable":
                            details.valid = true;
                            details.name = "PABLE";
                            details.group = 4;
                            break;
                        case "Shareability":
                            details.valid = true;
                            details.name = "SDOMAIN";
                            details.group = 4;
                            break;
                        case "Outer Cache":
                            details.valid = true;
                            details.name = "OUTER";
                            details.group = 4;
                            break;
                        case "Inner Cache":
                            details.valid = true;
                            details.name = "INNER";
                            details.group = 4;
                            break;
                        case "Mirrored Sideband":
                            details.valid = true;
                            details.name = "CMSIDEBAND";
                            details.group = 5;
                            break;
                        case "Sideband":
                            details.valid = true;
                            details.name = "CSIDEBAND";
                            details.group = 5;
                            break;
                        case "Flush":
                            details.valid = true;
                            details.name = "FLUSH";
                            details.group = 5;
                            break;
                        case "Firewall Status":
                            details.valid = true;
                            details.name = "FWPASS";
                            details.group = 5;
                            break;
                        case "Slave Select":
                            details.valid = true;
                            details.name = "ASEL";
                            details.group = 5;
                            break;
                        default:
                            details.valid = false;
                    }

                    return details;
                },

                _getUIFilterName: function(internalName) {
                    //TODO - update XML to use UI names or create name map.
                    var uiName = "";

                    switch(internalName) {

                        case "Channel ID":
                            uiName = internalName;
                            break;
                        case "Order ID":
                            uiName = internalName;
                            break;
                        case "AMODE":
                            uiName = "Address Mode";
                            break;
                        case "Route ID":
                            uiName = internalName;
                            break;                        
                        case "RSEL":
                            uiName = "Region Select";
                            break;
                        case "Virtual ID":
                            uiName = "VIRTID";
                            break;
                        case "EXCL":
                            uiName = "Exclusive";
                            break;
                        case "DIR":
                            uiName = "Direction";
                            break;
                        case "DTYPE":
                            uiName = "Data Type";
                            break;
                        case "CLSIZE":
                            uiName = "Line Size";
                            break;
                        case "BYTECOUNT":
                            uiName = "Byte Count";
                            break;
                        case "OPCODE":
                            uiName = "OP Code";
                            break;
                        case "MEMTYPE":
                            uiName = "Memory Type";
                            break;
                        case "ATYPE":
                            uiName = "Address Type";
                            break;
                        case "EPRIORITY":
                            uiName = "Escalated Priority";
                            break;
                        case "PRIORITY":
                            uiName = "Priority";
                            break;
                        case "QOS":
                            uiName = "QoS";
                            break;
                        case "EMUDBG":
                            uiName = "Debug Initiated";
                            break;
                        case "INTEREST":
                            uiName = "Interest";
                            break;
                        case "PRIV":
                            uiName = "Privilege";
                            break;
                        case "SECURE":
                            uiName = "Secure";
                            break;
                        case "PRIVID":
                            uiName = "Privilege ID";
                            break;
                        case "PABLE":
                            uiName = "Pre-fetchable";
                            break;
                        case "SDOMAIN":
                            uiName = "Shareability";
                            break;
                        case "OUTER":
                            uiName = "Outer Cache";
                            break;
                        case "INNER":
                            uiName = "Inner Cache";
                            break;
                        case "CMSIDEBAND":
                            uiName = "Mirrored Sideband";
                            break;
                        case "CSBAND":
                            uiName = "Sideband";
                            break;
                        case "FLUSH":
                            uiName = "Flush";
                            break;
                        case "FWPASS":
                            uiName = "Firewall Status";
                            break;
                        case "ASEL":
                            uiName = "Slave Select";
                            break;
                        default:
                            uiName = internalName;
                    }

                    return uiName;
                },

                _setProbeConfigValue(tree, probe, useCase, sampleWindow, lowStr, highStr, exclude) {

                    var _self = this;
                    var success = false;
                    var lowNum = parseInt(lowStr);
                    var highNum = parseInt(highStr);
                    var low = (0xffffffff & lowNum) >>> 0;
                    var lowExt = lowNum >>> 48;
                    var high = (0xffffffff & highNum) >>> 0;
                    var highExt = highNum >>> 48;

                    if (tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties instanceof Array) {
                        for(var i=0; i<tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties.length; i++) {
                            if (probe == tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].name) {
                                tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[0].value = useCase;
                                tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[1].value = parseInt(sampleWindow);
                                tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[2].sub_properties[0].value.address = low;
                                tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[2].sub_properties[1].value = lowExt;
                                tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[2].sub_properties[2].value.address = high;
                                tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[2].sub_properties[3].value = highExt;
                                tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[2].sub_properties[4].value = exclude;
                                success = true;   
                            }
                        }
                    }

                    return success;
                },

                _setFilterValue(tree, probe, filterName, value, mask, clear) {

                    var _self = this;
                    var success = true;
                    var filterSet = false;
                    var maskSet = false;

                    if (tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties instanceof Array) {
                        for(var i=0; i<tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties.length; i++) {
                            if (probe == tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].name) {

                                var details = _self._getInternalFilterDetails(filterName);
                                if (!details.valid) {
                                    success = false;
                                    break;
                                }

                                var internalFilterName = details.name;
                                var internalMaskName = details.name + " Mask";
                                var filterGroup = details.group;

                                if (filterGroup < 5) {
                                    for (var j=0; j<tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties.length; j++) {
                                        if (internalFilterName == tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].name) {
                                            if (clear) {
                                                if (tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].type == "Number") {
                                                    tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].value = "0x0";
                                                    filterSet = true;
                                                }
                                                else if (tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].type == "Boolean") {
                                                    tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].value = false;
                                                    filterSet = true;
                                                }
                                            }
                                            else {
                                                tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].value = value;
                                                filterSet = true;
                                            }
                                        }
                                        else if (internalMaskName == tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].name) {
                                            if (clear) {
                                                if (tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].type == "Number") {
                                                    tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].value = "0x0";
                                                    maskSet = true;
                                                }
                                                else if (tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].type == "Boolean") {
                                                    tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].value = false;
                                                    maskSet = true;
                                                }
                                            }
                                            else {
                                                tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[filterGroup].sub_properties[j].value = mask;
                                                maskSet = true;
                                            }
                                        }
                                    }  
                                }
                                else if (filterGroup == 5) {
                                    for (var j=0; j<tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties.length; j++) {
                                        if (internalFilterName == tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].name) {
                                            if (clear) {
                                                if (tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].type == "Number") {
                                                    tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].value = "0x0";
                                                    filterSet = true;
                                                }
                                                else if (tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].type == "Boolean") {
                                                    tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].value = false;
                                                    filterSet = true;
                                                }
                                            }
                                            else {
                                                tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].value = value;
                                                filterSet = true;   
                                            }
                                        }
                                        else if (internalMaskName == tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].name) {
                                            if (clear) {
                                                if (tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].type == "Number") {
                                                    tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].value = "0x0";
                                                    maskSet = true;
                                                }
                                                else if (tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].type == "Boolean") {
                                                    tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].value = false;
                                                    maskSet = true;
                                                }
                                            }
                                            else {
                                                tree[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[3].sub_properties[j].value = mask;
                                                maskSet = true;
                                            }
                                        }
                                    }
                                }

                                if (filterSet && maskSet) {
                                    success = true;
                                    break;           
                                }             
                            }
                        }
                    }

                    _self._updateFilterList();

                    return success;
                },

                _inputValueChanged: function(event) {
                    var _self = this;
                    var inputName = "";
                    if ("filterInput" == event.currentTarget.id) {
                        inputName = " value: ";
                    }
                    else if ("filterMaskInput" == event.currentTarget.id) {
                        inputName = " mask: ";
                    }

                    try {
                        if( !/^(0x)?[0-9a-f]+$/i.test(event.detail.newValue) ) {
                            throw "Not a number";
                        }
                        var value = parseInt(event.detail.newValue);
                        var rangeLow = parseInt(_self.currentFilter.rangelow);
                        var rangeHigh = parseInt(_self.currentFilter.rangehigh);

                        if (isNaN(value) || ((value < rangeLow) || (value > rangeHigh))) {
                            _self.$.filterInputToast.message = "Invalid "+ _self.currentFilter.name + inputName + event.detail.newValue;
                            _self.$.filterInputToast.showToast();
                            if ("filterInput" == event.currentTarget.id) {
                                // TODO - ti-widget-input is sending an event with newValue and oldValue matching. (GC-1522)
                                // For now just set it to 0x0.
                                //_self.filterInputValue = event.detail.oldValue;
                                _self.filterInputValue = "0x0";
                            }
                            else if ("filterMaskInput" == event.currentTarget.id) {
                                // TODO - ti-widget-input is sending an event with newValue and oldValue matching. (GC-1522)
                                // For now just set it to 0x0.
                                //_self.filterMaskInputValue = event.detail.oldValue;
                                _self.filterMaskInputValue = "0x0";
                            }
                        }
                    }
                    catch(e) {
                        _self.$.filterInputToast.message = "Invalid "+ _self.currentFilter.name + inputName + event.detail.newValue;
                        _self.$.filterInputToast.showToast();
                        if ("filterInput" == event.currentTarget.id) {
                             // TODO GC-1522
                            _self.filterInputValue = "0x0";
                        }
                        else if ("filterMaskInput" == event.currentTarget.id) {
                             // TODO GC-1522
                            _self.filterMaskInputValue = "0x0";
                        }
                    }

                    // Always re-display the number back as a hex string.
                    if ("filterInput" == event.currentTarget.id) {
                        if (_self.filterInputValue.length > 2) {
                            if (_self.filterInputValue.substring(0,2).toLowerCase() != "0x") {
                                _self.filterInputValue = "0x" + _self.filterInputValue.toString(16);
                            }
                        }
                        else {
                            _self.filterInputValue = "0x" + _self.filterInputValue.toString(16);
                        }
                    }
                    else if ("filterMaskInput" == event.currentTarget.id) {
                        if (_self.filterMaskInputValue.length > 2) {
                            if (_self.filterMaskInputValue.substring(0,2).toLowerCase() != "0x") {
                                _self.filterMaskInputValue = "0x" + _self.filterMaskInputValue.toString(16);
                            }
                        }
                        else {
                            _self.filterMaskInputValue = "0x" + _self.filterMaskInputValue.toString(16);
                        }
                    }

                    // Update temporary tree with new values.
                    if(!_self._setFilterValue(_self.workingAetProperties, _self.currentProbe, _self.filterTreeSelected.data.name, _self.filterInputValue, _self.filterMaskInputValue, false)) {
                        console.log("Failed to set filter property tree for "+_self.currentProbe+".");        
                    }
                },

                _getProbeUseCase: function(probeName) {

                    var _self = this;
                    var currentProps = _self.aetProperties;
                    var useCase = "";

                    if (currentProps instanceof Array) {

                        var probeCount = currentProps[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties.length;
                        for (var i = 0; i < probeCount; i++) {
                            var probe = currentProps[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i];
                            if (probe.name == probeName) {
                                // Use case is only set if the probe is enabled.
                                if (currentProps[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].value) {
                                    useCase = currentProps[0].sub_properties[0].sub_properties[0].sub_properties[0].sub_properties[i].sub_properties[0].value;
                                    break;
                                }
                            }
                        }
                    }

                    return useCase;
                },

                _zeroSuppressChanged: function(newValue) {

                    var _self = this;
                    
                    if (_self.aetProperties != undefined) {
                        _self.aetProperties[0].sub_properties[0].sub_properties[0].sub_properties[1].sub_properties[1].value = newValue;               
                    }

                },

                _currentProbeChanged: function(newValue) {
                    
                    var _self = this;

                    _self.currentUseCase = _self._getProbeUseCase(newValue);
                }

            });
        </script>
    </dom-module>


</body>

</html>
